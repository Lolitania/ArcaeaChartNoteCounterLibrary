# Arcaea Chart Note Counter Library

A really simple [Arcaea](https://arcaea.lowiro.com/) chart note counter library written in C# (.NET 9).

Last updated for Arcaea v6.3.3.

## How to use

Simply call one of the following two static methods:

```csharp
static int Moe.Lowiro.Arcaea.Chart.CountNote(string path, bool specialGreen = false);
```
```csharp
static int Moe.Lowiro.Arcaea.Chart.CountNote(System.IO.Stream stream, bool specialGreen = false);
```

## Notes about compiling

Do **NOT** check *"Code Optimization"* in the Project Properties. It will affect floating point errors.

## Example

This is an example of using this library to count the notes of all charts and saving the results as CSV.

Note that we do not offer Arcaea charts due to copyright reasons. Please get them yourself.

```csharp
using System.Text;
using static Moe.Lowiro.Arcaea.Chart;

const int FileNotExist = -2;
const int ChartError = -1;

var CurrentPath = Directory.GetCurrentDirectory();
var text = new StringBuilder("ID,PST,PRS,FTR,BYD,ETR");
var counts = new int[5];
foreach (var folder in new DirectoryInfo(CurrentPath).GetDirectories())
{
    var id = folder.Name;
    var ok = false;
    for (var i = 0; i < 5; ++i)
    {
        var count = Count(id, i);
        counts[i] = count;
        if (count != FileNotExist)
        {
            ok = true;
        }
    }

    if (!ok) continue;
    text.AppendLine();
    text.Append(id);
    for (var i = 0; i < 5; ++i)
    {
        Append(text, counts[i]);
    }
}

text.AppendLine();
text.AppendLine(",,,,,");
text.AppendLine("Generated by Arcaea Chart Note Counter,,,,,");
File.WriteAllText($@"{CurrentPath}\result.csv", text.ToString(), new UTF8Encoding(false));
return;

int Count(string id, int level)
{
    var path = $@"{CurrentPath}\{id}\{level}.aff";
    if (!File.Exists(path)) return FileNotExist;
    try
    {
        return CountNote(path, level == 3 && id == "yourbestnightmare");
    }
    catch (Exception e)
    {
        Console.WriteLine($"{id}/{level}.aff: {e.Message}");
        return ChartError;
    }
}

void Append(StringBuilder builder, int value)
{
    builder.Append(',');
    switch (value)
    {
    case FileNotExist: break;
    case ChartError: builder.Append("ERROR"); break;
    default: builder.Append(value); break;
    }
}
```
